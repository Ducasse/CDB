"
- write tests
- remove CdbEnumeration. 
"
Class {
	#name : #NewCDBTest,
	#superclass : #TestCase,
	#instVars : [
		'testingWorkingDirectory'
	],
	#category : #'CDBFormat-Test-New'
}

{ #category : #ressources }
NewCDBTest class >> cdbFile [

	^ 'file.cdb'
]

{ #category : #ressources }
NewCDBTest class >> cdbFileContents [
	"three key 'one' asByteArray, 'three' asByteArray, 'four' asByteArray"
	
	^ 'VQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAACAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAIAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAIAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAAAFAAAAFQAAAHRocmVlR29sZGVuIFN0YXRlIFdhcnJpb3JzBAAAABcAAABmb3VyUmVjb3JkIG9mIENoaWNhZ28gQnVsbHMDAAAABQAAAG9uZVJhbWJva0brCgAIAAAAAAAAAAAAAAAAAAAAAAAAgVuHC0UIAACrLm58IggAAAAAAAAAAAAA'
]

{ #category : #ressources }
NewCDBTest class >> decodedCDBFileContents [
	^ self encodedCDBFileContents base64Decoded
]

{ #category : #ressources }
NewCDBTest class >> encodedCDBFileContents [
	"three key 'one' asByteArray, 'three' asByteArray, 'four' asByteArray"
	"this string is a base64encoded cdb file."
	^ 'VQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAAAAAAAVQgAAAAAAABVCAAAAAAAAFUIAAACAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAAAAABlCAAAAAAAAGUIAAAAAAAAZQgAAAIAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAAAAAB1CAAAAAAAAHUIAAAAAAAAdQgAAAIAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAACFCAAAAAAAAIUIAAAAAAAAhQgAAAAAAAAFAAAAFQAAAHRocmVlR29sZGVuIFN0YXRlIFdhcnJpb3JzBAAAABcAAABmb3VyUmVjb3JkIG9mIENoaWNhZ28gQnVsbHMDAAAABQAAAG9uZVJhbWJva0brCgAIAAAAAAAAAAAAAAAAAAAAAAAAgVuHC0UIAACrLm58IggAAAAAAAAAAAAA'
]

{ #category : #tests }
NewCDBTest >> testHash [ 

	self assert: #[1] cdbHash equals: 177572.
	self assert: #[11] cdbHash equals: 177582.
	self assert: #[1 1] cdbHash equals: 5859877.
]

{ #category : #tests }
NewCDBTest >> testNextElement [

	| em element |
	em := CdbEnumeration new.
	em initializeWithByteArray: self class cdbFileContents base64Decoded readStream.
	element := em nextElement.
	self assert: element key asString equals: 'three'.
	self assert: element data asString equals: 'Golden State Warriors'.
	
	element := em nextElement.
	self assert: element key asString equals: 'four'.
	self assert: element data asString equals: 'Record of Chicago Bulls'.

]

{ #category : #tests }
NewCDBTest >> testReadFile [

	| em element |
	testingWorkingDirectory := FileSystem memory workingDirectory.
	(testingWorkingDirectory / self class cdbFile)
		writeStreamDo: [ :stream | 
			stream nextPutAll: self class encodedCDBFileContents ].
		
	em := CdbEnumeration new.
	em initializeWithByteArray: (testingWorkingDirectory / self class cdbFile) contents base64Decoded.
	element := em nextElement.
	self assert: element key asString equals: 'three'.
	self assert: element data asString equals: 'Golden State Warriors'.
	
	element := em nextElement.
	self assert: element key asString equals: 'four'.
	self assert: element data asString equals: 'Record of Chicago Bulls'.

]

{ #category : #tests }
NewCDBTest >> testReadFile2 [

	| em element |
	testingWorkingDirectory := FileSystem memory workingDirectory.
	(testingWorkingDirectory / self class cdbFile)
		writeStreamDo: [ :stream | 
			stream nextPutAll: self class encodedCDBFileContents ].
		
	em := CdbEnumeration new.
	em initialize: (testingWorkingDirectory / self class cdbFile) contents base64Decoded.
	element := em nextElement.
	self assert: element key asString equals: 'three'.
	self assert: element data asString equals: 'Golden State Warriors'.
	
	element := em nextElement.
	self assert: element key asString equals: 'four'.
	self assert: element data asString equals: 'Record of Chicago Bulls'.

]

{ #category : #tests }
NewCDBTest >> testReadFromByteArray [

	| em element |
	em := CdbEnumeration new.
	em initializeWithByteArray: self class cdbFileContents base64Decoded readStream.
	element := em nextElement.
	self assert: element key asString equals: 'three'.
	self assert: element data asString equals: 'Golden State Warriors'.
	
	element := em nextElement.
	self assert: element key asString equals: 'four'.
	self assert: element data asString equals: 'Record of Chicago Bulls'.

]
